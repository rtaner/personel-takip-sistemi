<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personel Takip Sistemi</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ‘¥</text></svg>">
    <link rel="stylesheet" href="style_clean.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-users"></i> Personel Takip Sistemi</h1>
                <p>1854 - Bilecik BozÃ¼yÃ¼k</p>
            </div>
            <!-- KullanÄ±cÄ± bilgileri JavaScript ile eklenecek -->
        </header>

        <nav class="tab-nav">
            <button class="tab-btn active" onclick="showTab('personel')">
                <i class="fas fa-user-friends"></i> Personel Listesi
            </button>
            <button class="tab-btn" onclick="showTab('detay')" id="detay-tab-btn" style="display: none;">
                <i class="fas fa-user"></i> Personel DetayÄ±
            </button>
            <button class="tab-btn" onclick="showTab('dashboard')" data-role="organizasyon_sahibi,yonetici">
                <i class="fas fa-chart-bar"></i> Dashboard
            </button>
            <button class="tab-btn" onclick="showTab('my-work')" data-role="personel,yonetici">
                <i class="fas fa-briefcase"></i> Ä°ÅŸlerim
            </button>
            <button class="tab-btn" onclick="window.location.href='/organization.html'" data-role="organizasyon_sahibi">
                <i class="fas fa-building"></i> Organizasyon
            </button>
        </nav>

        <!-- Personel Sekmesi -->
        <div id="personel-tab" class="tab-content active">
            <div class="section-header">
                <h2>Personel Listesi</h2>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="showPersonelForm()" data-permission="edit_personnel">
                        <i class="fas fa-plus"></i> Yeni Personel
                    </button>


                </div>
            </div>
            
            <div id="personel-form" class="form-container" style="display: none;">
                <h3>Yeni Personel Ekle</h3>
                <form onsubmit="addPersonel(event)">
                    <div class="form-row">
                        <input type="text" id="ad" placeholder="Ad" required>
                        <input type="text" id="soyad" placeholder="Soyad" required>
                    </div>
                    <div class="form-row">
                        <input type="text" id="pozisyon" placeholder="Pozisyon" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">Kaydet</button>
                        <button type="button" class="btn btn-secondary" onclick="hidePersonelForm()">Ä°ptal</button>
                    </div>
                </form>
            </div>

            <div id="personel-list" class="personel-grid"></div>
        </div>

        <!-- Personel Detay Sekmesi -->
        <div id="detay-tab" class="tab-content">
            <div class="section-header">
                <h2 id="personel-detay-baslik">Personel DetayÄ±</h2>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="showNoteForm()">
                        <i class="fas fa-plus"></i> Not Ekle
                    </button>
                    <button class="btn btn-secondary" onclick="showTaskForm()" data-permission="assign_tasks">
                        <i class="fas fa-tasks"></i> GÃ¶rev Ata
                    </button>
                </div>
            </div>

            <!-- Not Ekleme Formu -->
            <div id="note-form" class="form-container" style="display: none;">
                <h3>Yeni Not Ekle</h3>
                <div class="voice-controls">
                    <button id="voice-btn" class="btn btn-voice" onclick="toggleVoiceRecording()">
                        <i class="fas fa-microphone"></i> <span id="voice-btn-text">Sesli Not</span>
                    </button>
                    <span id="voice-status"></span>
                </div>
                <textarea id="not-metni" placeholder="Not yazÄ±n veya sesli not iÃ§in mikrofon butonuna basÄ±n..." rows="4" required></textarea>
                <div class="note-type-buttons">
                    <button type="button" class="btn btn-success" onclick="addNoteWithType('olumlu')">
                        <i class="fas fa-thumbs-up"></i> Olumlu Not Ekle
                    </button>
                    <button type="button" class="btn btn-danger" onclick="addNoteWithType('olumsuz')">
                        <i class="fas fa-thumbs-down"></i> Olumsuz Not Ekle
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="hideNoteForm()">Ä°ptal</button>
                </div>
            </div>

            <!-- GÃ¶rev Ekleme Formu -->
            <div id="task-form" class="form-container" style="display: none;">
                <h3 id="task-form-title">Yeni GÃ¶rev Ata</h3>
                <form onsubmit="addTask(event)">
                    <input type="text" id="gorev-baslik" placeholder="GÃ¶rev BaÅŸlÄ±ÄŸÄ±" required>
                    <textarea id="gorev-aciklama" placeholder="GÃ¶rev AÃ§Ä±klamasÄ±" rows="3"></textarea>
                    <input type="date" id="bitis-tarihi" placeholder="BitiÅŸ Tarihi">
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">GÃ¶rev Ata</button>
                        <button type="button" class="btn btn-secondary" onclick="hideTaskForm()">Ä°ptal</button>
                    </div>
                </form>
            </div>

            <!-- Notlar ve GÃ¶revler Listesi -->
            <div id="activities-list"></div>
        </div>

        <!-- Dashboard Sekmesi (Herkes) -->
        <div id="dashboard-tab" class="tab-content" data-role="organizasyon_sahibi,yonetici,personel">
            <div class="section-header">
                <h2>Dashboard</h2>
            </div>

            <!-- Ana HoÅŸ Geldin MesajÄ± -->
            <div id="dashboard-welcome" class="dashboard-section active">
                <div class="welcome-message">
                    <i class="fas fa-tachometer-alt"></i>
                    <h3>Dashboard'a HoÅŸ Geldiniz</h3>
                    <p>AÅŸaÄŸÄ±daki butonlardan istediÄŸiniz bÃ¶lÃ¼me eriÅŸebilirsiniz.</p>
                </div>
            </div>

            <!-- Dashboard Ana MenÃ¼ -->
            <div id="dashboard-main-menu" class="dashboard-buttons">
                <button class="dashboard-btn" onclick="showDashboardSection('org-stats')" data-role="organizasyon_sahibi">
                    <i class="fas fa-chart-pie"></i>
                    <span>Ä°statistikler</span>
                    <small>DetaylÄ± organizasyon verileri</small>
                </button>

                <button class="dashboard-btn" onclick="showDashboardSection('ai-analysis')" data-role="organizasyon_sahibi">
                    <i class="fas fa-brain"></i>
                    <span>AI Analiz</span>
                    <small>Personel analizi ve raporlama</small>
                </button>

                <button class="dashboard-btn" onclick="showDashboardSection('user-management')" data-role="organizasyon_sahibi">
                    <i class="fas fa-users-cog"></i>
                    <span>KullanÄ±cÄ± YÃ¶netimi</span>
                    <small>KullanÄ±cÄ± rolleri ve yetkileri</small>
                </button>

                <button class="dashboard-btn" onclick="showDashboardSection('export')" data-role="organizasyon_sahibi,yonetici">
                    <i class="fas fa-download"></i>
                    <span>DÄ±ÅŸa Aktar</span>
                    <small>Export iÅŸlemleri + bilgilendirme</small>
                </button>

                <button class="dashboard-btn" onclick="showDashboardSection('invite')" data-role="organizasyon_sahibi">
                    <i class="fas fa-user-plus"></i>
                    <span>Davet Kodu</span>
                    <small>Yeni kullanÄ±cÄ± davet sistemi</small>
                </button>

                <button class="dashboard-btn" onclick="showDashboardSection('settings')" data-role="organizasyon_sahibi">
                    <i class="fas fa-cog"></i>
                    <span>Organizasyon AyarlarÄ±</span>
                    <small>Organizasyon bilgileri ve ayarlarÄ±</small>
                </button>
            </div>

            <!-- Dashboard Ä°Ã§erik AlanlarÄ± -->
            <div id="dashboard-content" class="dashboard-content">



                <!-- Organizasyon Ä°statistikleri BÃ¶lÃ¼mÃ¼ -->
                <div id="dashboard-org-stats-section" class="dashboard-section">
                    <div class="section-header">
                        <h3><i class="fas fa-chart-pie"></i> Organizasyon Ä°statistikleri</h3>
                        <button class="btn btn-secondary btn-sm" onclick="returnToDashboardMain()">
                            <i class="fas fa-arrow-left"></i> Geri DÃ¶n
                        </button>
                    </div>
                    <div class="card-content">
                        <div id="org-stats-content" class="stats-grid">
                            <div class="loading"><i class="fas fa-spinner fa-spin"></i> Ä°statistikler yÃ¼kleniyor...</div>
                        </div>
                        <div id="recent-users-section" style="margin-top: 30px;">
                            <h4><i class="fas fa-users"></i> Son KullanÄ±cÄ±lar</h4>
                            <div id="recent-users-content" class="user-list">
                                <div class="loading"><i class="fas fa-spinner fa-spin"></i> KullanÄ±cÄ±lar yÃ¼kleniyor...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Analiz BÃ¶lÃ¼mÃ¼ -->
                <div id="dashboard-ai-analysis-section" class="dashboard-section">
                    <div class="section-header">
                        <h3><i class="fas fa-brain"></i> AI Personel Analizi</h3>
                        <button class="btn btn-secondary btn-sm" onclick="returnToDashboardMain()">
                            <i class="fas fa-arrow-left"></i> Geri DÃ¶n
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="ai-analysis-info">
                            <div class="info-card">
                                <i class="fas fa-robot"></i>
                                <h4>Ä°K UzmanÄ± Seviyesinde AI Analizi</h4>
                                <p>Personel seÃ§erek kapsamlÄ± Ä°K analizi yapabilir, risk seviyesi belirleyebilir ve eylem planlarÄ± alabilirsiniz.</p>
                            </div>
                        </div>
                        
                        <div class="analysis-controls">
                            <div class="control-group">
                                <label>Analiz Edilecek Personel:</label>
                                <select id="ai-analysis-personel-select" onchange="updateAIAnalysisButtons()">
                                    <option value="">Personel seÃ§in...</option>
                                </select>
                            </div>
                            
                            <div class="analysis-buttons">
                                <button class="btn btn-purple btn-lg" onclick="generateAIAnalysis()" id="generate-ai-analysis-btn" disabled>
                                    <i class="fas fa-brain"></i> Ä°K Analizi Yap
                                </button>
                                <button class="btn btn-info btn-lg" onclick="showLastAIAnalysis()" id="show-last-ai-analysis-btn" disabled>
                                    <i class="fas fa-history"></i> Son Analizi GÃ¶rÃ¼ntÃ¼le
                                </button>
                                <button class="btn btn-secondary btn-lg" onclick="showAnalysisHistory()" id="show-analysis-history-btn" disabled>
                                    <i class="fas fa-list"></i> Analiz GeÃ§miÅŸi
                                </button>
                            </div>
                            
                            <div class="analysis-features">
                                <div class="feature-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span>TÃ¼m notlarÄ± ve performans verilerini analiz eder</span>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Risk seviyesi belirler ve erken uyarÄ± verir</span>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Somut eylem planlarÄ± ve Ã¶neriler sunar</span>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span>DetaylÄ± HTML rapor olarak indirilebilir</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KullanÄ±cÄ± YÃ¶netimi BÃ¶lÃ¼mÃ¼ -->
                <div id="dashboard-user-management-section" class="dashboard-section">
                    <div class="section-header">
                        <h3><i class="fas fa-users-cog"></i> KullanÄ±cÄ± YÃ¶netimi</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary btn-sm" onclick="loadOrganizationUsers()">
                                <i class="fas fa-sync-alt"></i> Yenile
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="returnToDashboardMain()">
                                <i class="fas fa-arrow-left"></i> Geri DÃ¶n
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="users-management-content" class="user-list">
                            <div class="loading"><i class="fas fa-spinner fa-spin"></i> KullanÄ±cÄ±lar yÃ¼kleniyor...</div>
                        </div>
                    </div>
                </div>

                <!-- DÄ±ÅŸa Aktar BÃ¶lÃ¼mÃ¼ -->
                <div id="dashboard-export-section" class="dashboard-section">
                    <div class="section-header">
                        <h3><i class="fas fa-download"></i> DÄ±ÅŸa Aktar</h3>
                        <button class="btn btn-secondary btn-sm" onclick="returnToDashboardMain()">
                            <i class="fas fa-arrow-left"></i> Geri DÃ¶n
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="export-info">
                            <p><i class="fas fa-info-circle"></i> Personel seÃ§erek notlarÄ±nÄ± ve gÃ¶revlerini dÄ±ÅŸa aktarabilirsiniz.</p>
                        </div>
                        <div class="export-controls">
                            <div class="control-group">
                                <label>Personel SeÃ§:</label>
                                <select id="export-personel-select" onchange="updateExportButtons()">
                                    <option value="">Personel seÃ§in...</option>
                                </select>
                            </div>
                            <div class="export-buttons">
                                <button class="btn btn-success" onclick="exportSelectedPersonel('excel')" id="export-excel-btn" disabled>
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn btn-danger" onclick="exportSelectedPersonel('pdf')" id="export-pdf-btn" disabled>
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Davet Kodu BÃ¶lÃ¼mÃ¼ -->
                <div id="dashboard-invite-section" class="dashboard-section">
                    <div class="section-header">
                        <h3><i class="fas fa-user-plus"></i> Davet Kodu YÃ¶netimi</h3>
                        <button class="btn btn-secondary btn-sm" onclick="returnToDashboardMain()">
                            <i class="fas fa-arrow-left"></i> Geri DÃ¶n
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="invite-section-modern">
                            <div class="invite-header">
                                <div class="invite-icon">
                                    <i class="fas fa-link"></i>
                                </div>
                                <h4>Davet Kodu YÃ¶netimi</h4>
                                <p>Yeni kullanÄ±cÄ±larÄ± organizasyonunuza davet etmek iÃ§in aÅŸaÄŸÄ±daki kodu paylaÅŸÄ±n:</p>
                            </div>
                            
                            <div class="invite-code-box">
                                <div class="code-display" id="invite-code-display">
                                    <div class="loading"><i class="fas fa-spinner fa-spin"></i></div>
                                </div>
                            </div>
                            
                            <div class="invite-actions-modern">
                                <button class="btn btn-copy-modern" onclick="copyInviteCodeModern()">
                                    <i class="fas fa-copy"></i> Kopyala
                                </button>
                                <button class="btn btn-generate-modern" onclick="generateNewInviteCode()">
                                    <i class="fas fa-sync-alt"></i> Yeni Kod OluÅŸtur
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Organizasyon AyarlarÄ± BÃ¶lÃ¼mÃ¼ -->
                <div id="dashboard-settings-section" class="dashboard-section">
                    <div class="section-header">
                        <h3><i class="fas fa-cog"></i> Organizasyon AyarlarÄ±</h3>
                        <button class="btn btn-secondary btn-sm" onclick="returnToDashboardMain()">
                            <i class="fas fa-arrow-left"></i> Geri DÃ¶n
                        </button>
                    </div>
                    <div class="card-content">
                        <div id="org-settings-content">
                            <div class="loading"><i class="fas fa-spinner fa-spin"></i> Ayarlar yÃ¼kleniyor...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ä°ÅŸlerim Sekmesi (Personel ve YÃ¶netici) -->
        <div id="my-work-tab" class="tab-content" data-role="personel,yonetici">
            <div class="section-header">
                <h2>Ä°ÅŸlerim</h2>
            </div>
            <div id="my-work-content">
                <div class="empty-state">
                    <i class="fas fa-briefcase"></i>
                    <p>GÃ¶revleriniz yÃ¼kleniyor...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="route-guard.js"></script>
    <script src="app.js"></script>
</body>
</html>